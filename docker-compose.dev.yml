version: "3.8"

services:
  server:
    ports:
      - "3000:3000" # publish server port to host for dev
    environment:
      - NODE_ENV=development

  client:
    ports:
      - "8080:80" # expose client at http://localhost:8080
    build:
      args:
        PUBLIC_API_URL: "http://localhost:3000"

  scraper:
    # Dev overrides for the scraper service. You can toggle behaviour by changing RUN_MODE and SCRAPE_ON_START:
    # - RUN_MODE=once       => run a single scrape on container start, then exit (container may restart depending on policy)
    # - RUN_MODE=scheduled  => keep container running and scrape on schedule; set SCRAPE_ON_START=true to run immediately on startup
    environment:
      - RUN_MODE=scheduled
      - CRON_SCHEDULE=0 2 * * *
      - SCRAPE_ON_START=true
    depends_on:
      - server
    restart: no
